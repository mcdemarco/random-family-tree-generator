<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <title>Random Family Tree Generator</title>
    <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
    <style type="text/css">
      <!--
          body {background-color:#7e9cbb;}
          #intro {	
	        text-align:left; 
	        border:1px solid #ccc; 
	        padding:5px;
	        margin:5px 5px 20px 5px; 
	        background-color:#7ebb9c;
          }

          #intro a:link, #footer a:visited {
	        text-decoration:none;
	        color:#900;
          }

          #intro a:hover, #footer a:active{color:#f54242;}

          ul {margin:3px 0 0 10px;padding:0;}
          li {display:inline;list-style-type:none;}
          ul li a {text-decoration:none; background-color:#D4D4D4; border:3px solid #f1f1f1; border-bottom:2px solid #333; border-right:3px solid #333;margin:3px;color:#000;}
          .color1 {background-color:#fff;}
          .color2 {background-color:#fcc;}
          .color3 {background-color:#fc9;}
          .color4 {background-color:#ff9;}
          .color5 {background-color:#cf9;}
          .color6 {background-color:#9f9;}
          .color7 {background-color:#9fc;}
          .color8 {background-color:#9ff;}
          .color9 {background-color:#9cf;}
          .color10 {background-color:#99f;}
          .color11 {background-color:#c9f;}
          .color12 {background-color:#f9f;}
          .color13 {background-color:#f99;}

          #footer {
	        position:absolute;
	        bottom:0px;
	        left:0px;
	        right:0px;
	        margin:5px 5px 20px 15px; 
	        font-size:9px;
	        text-align:left;
	        background-color:#7ebb9c;
	        padding:5px;
	        border:1px solid #ccc; 
          }

          #footer a:link, #footer a:visited {
	        text-decoration:none;
	        color:#900;
          }

          #footer a:hover, #footer a:active{color:#f54242;}

        -->
    </style>

<script language="JavaScript" src="http://davidbau.com/encode/seedrandom.js"></script>

<script language="JavaScript" type="text/JavaScript">

// Grabbed off of http://ja.partridgez.com/lineage.html
// apparently (C) Jeff Partridge,
// from a Create Commons Attribution-Noncommercial-Share Alike-3.0 United States License
// ...
// Then I fixed a lot of bugs, added code to give Females names that are more
// asian (appropriate to my campaign), and made use of a seedable rand so trees can
// be consistently regenerated.  Saves on printing them out and wasting paper.
// -- Todd Stumpf 2010, Feb 20


function getRequestParameter( name ) {
    name = name.replace(/[\[]/,"\\\[").replace(/[\]]/,"\\\]");
    var regexS = "[\\?&]"+name+"=([^&#]*)";
    var regex = new RegExp( regexS );
    var results = regex.exec( window.location.href );
    if( results == null )
	return "";
    else
	return results[1];
}

var pid=0; //keeps track of each persons ID
var lcolor=0;	 //background color for each generation

Math.seedrandom(getRequestParameter("seed"));

function rollD(sides) { //multi-die rolling function
    return Math.round(Math.random() * (sides-1)) + 1;
}

// *** begin personality type generation code ***
function goGetType() {
    var EI=typeEI();
    var SN=typeSN();
    var TF=typeTF();
    var JP=typeJP();
    var pType=EI+SN+TF+JP;
    var descript=" Type:"+pType+getTypeName(pType);
    return(descript);
}
function typeEI() { // these are the 4 axis of the Myers-Briggs personality types
    var EI="";
    var roll=""; // their distribution should approximate the frequency they
    roll = rollD(4);	// occur in real life.
    (roll>1) ? EI="E" :	EI="I";
    return EI;
}
function typeSN() {
    var SN="";
    var roll="";
    roll = rollD(4);
    (roll>1) ? SN="S" : SN="N";
    return SN;
}
function typeTF() {
    var TF="";
    var roll="";
    roll = rollD(2);
    (roll==2) ?	TF="T" : TF="F";
    return TF;
}
function typeJP() {
    var JP="";
    var roll="";
    roll = rollD(2);
    (roll==2) ? JP="J":	JP="P";
    return JP;
}
function getTypeName(pType) { //apply label to personality type
    var typeName = "";
    switch (pType) {
    case "ISFP": typeName="--(Artisan/Composer)"; break;
    case "ISTP": typeName="--(Artisan/Crafter)"; break;
    case "ESFP": typeName="--(Artisan/Performer)"; break;
    case "ESTP": typeName="--(Artisan/Promoter)"; break;		
    case "ISFJ": typeName="--(Guardian/Protector)"; break;
    case "ISTJ": typeName="--(Guardian/Inspector)"; break;
    case "ESFJ": typeName="--(Guardian/Provider)"; break;
    case "ESTJ": typeName="--(Guardian/Supervisor)"; break;		
    case "INFP": typeName="--(Idealist/Healer)"; break;
    case "INFJ": typeName="--(Idealist/Counselor)"; break;
    case "ENFP": typeName="--(Idealist/Champion)"; break;
    case "ENFJ": typeName="--(Idealist/Teacher)"; break;		
    case "INTP": typeName="--(Rational/Architect)"; break;
    case "INTJ": typeName="--(Rational/Mastermind)"; break;
    case "ENTP": typeName="--(Rational/Inventor)"; break;
    case "ENTJ": typeName="--(Rational/Field Marshal)"; break;		
    default: typeName=" --Oops! I didn't get the type";
    }
    return typeName;
}
// *** end personality type generation code ***

// *** begin lame name generation ***
function getname(person) {
    if (person.gender == "M") {
	return getEffname();
    }
    return getJalname();
}

function getJalname() {
    var syl = rollD(2) + rollD(2) + rollD(2) - 2;
    var count = 0;
    var jname = "";
    while (count < syl) {
	jname = jname + getSyl();
	count++;
    }
    return jname;
}

function getSyl() {
    var roll = rollD(75)-1;
    var sylabs=["ka", "ki", "ku", "ke", "ko",
		"a", "i", "u", "e", "o",
		"ta", "chi", "tsu", "te", "to",
		"ra", "ri", "ru", "re", "ro",
		"sa", "shi", "su", "se", "so",
		"ma", "mi", "mu", "me", "mo",
		"ya", "ya", "yu", "yo", "yo",
		"na", "ni", "nu", "ne", "no",
		"ha", "hi", "hu", "he", "ho",
		"ta", "chi", "tsu", "te", "to",
		"ra", "ri", "ru", "re", "ro",
		"sa", "shi", "su", "se", "so",
		"ma", "mi", "mu", "me", "mo",
		"wa", "wi", "wu", "we", "wo",
		"n", "n", "n", "n", "n" ];
    return sylabs[roll];
}

function getEffname() {
    var ccount = 0;
    var vcount = 0;
    var vanna = "";
    var roll=0;
    roll=rollD(6);
    if (roll<4) {
	vanna=get1vowel(); //does the name start with a vowel or a consonant?
	vcount++;
    } 
    else {
	vanna=get1con();
	ccount++;
    }
    var count = 0;
    var letLength=rollD(6)+1; //sets length of name from 3 to 8 letters.
    while (count < letLength)
    {
	if (ccount>1) {
	    vanna=vanna+getvowels();	 //no more than 2 vowels or consonants together
	    ccount=0;vcount++;
	}
	else if (vcount>1) {
	    vanna=vanna+getcons();
	    vcount=0;ccount++;
	}
	else {
	    roll=0;
	    roll=rollD(6);
	    if (roll<4) {
		vanna=vanna+getvowels();
		vcount++;
	    }	
	    else {
		vanna=vanna+getcons();
		ccount++;
	    }
	}
	count++;
    }		
    return(vanna);
}

function get1vowel() { // The frequency of letters should roughly approximate their
    var roll=0;				 // occurance in the English language.
    roll=rollD(10)-1;
    var firstvowel=["A","A","A","E","E","I","I","O","U","Y"];
    return firstvowel[roll];
}
function get1con() {
    var roll=0;
    roll=rollD(30)-1;
    var firstcon=["B","C","D","F","G","H","J","K","L","L","L","L","M","N","P","Q","R","R","R","R","S","S","S","T","V","W","X","Y","Y","Z"];
    return firstcon[roll];
}
function getvowels() {
    var roll=0;
    roll=rollD(10)-1;
    var vowels=["a","a","a","e","e","i","i","o","u","y"];
    return vowels[roll];
}
function getcons() {
    var roll=0;
    roll=rollD(30)-1;
    var cons=["b","c","d","f","g","h","j","k","l","l","l","l","m","n","p","q","r","r","r","r","s","s","s","t","v","w","x","y","y","z"];
    return cons[roll];
}
function getNewName(person, newname){ //this function is called when *surprise* 
    var oldname=document.getElementById(person);
    oldname.firstChild.firstChild.value=newname;	 //the user doesn't like the name suggested
}
// *** end lame name generation **

function getOpositeGender(gender) { // flip gender (for the spouse) if one is given
    var newgen = "";
    switch(gender) {			 // otherwise randomize it
    case "M":newgen="F";break;
    case "F":newgen="M";break;
    default:newgen=randgen();
    }
    return newgen;
}
function randgen() { // random gender
    var gen;
    (rollD(6)<4) ? gen ="M" : gen="F";
    return gen;
}

function getbday(married, gender) { // get birthday from day married and gender
    var mage;

    mage = rollD(9)+12; // women (who may produce progency) marry from age 13-21

    if (gender=="M") {	 // if male, potentially add a few years
	for (var i=0; i < 5; i++) {
	    mage += rollD(4)-1;
	}
    }

    var birth = married - mage;

    return birth;
}

function getdage(mday , mage) { // get age they die at
    var temp1a = rollD(20);
    var temp1b = rollD(20);
    var temp1;
    (temp1a < temp1b) ? temp1=temp1a : temp1=temp1b; // temp1 is the low of 2d20

    var temp2=rollD(8);

    var dage;
    if (temp2<5) {  // 50% dies as a child or teenager
	dage=temp1;
    } // this is to shape the prob curve of deaths
    else if (temp2<7) {
	dage=temp1a+20;  // 25% die in their 20-30's
    }
    else if (temp2==7) { // 12.5% die in their 40-50's
	dage=temp1a+40;
    }
    else if (temp2==8) { // 12.5% die in their 60-70's
	dage=temp1a+60;
    }

    if (dage && mage) {  // Generating spouse, so must be alive when married...
	while (dage < mage) {   // if died before married, set to marriage.
	    dage = mage;
	}
    }

    var death = dage;
    return death;
}
function getfert(fertstart) { // return fertility based on age
    var chance = 0;
    if (fertstart<14) {chance=10;}
    if (fertstart==14) {chance=20;}
    if (fertstart==15) {chance=40;}
    if (fertstart==16) {chance=60;}
    if (fertstart==17) {chance=80;}
    if (fertstart>17 && fertstart<30) {chance=98;}
    if (fertstart>30 && fertstart<35) {chance=80;}
    if (fertstart>35 && fertstart<40) {chance=40;}
    if (fertstart>40 && fertstart<45) {chance=20;}
    if (fertstart>44) {chance=3;}	 

    return chance;
}

function getKids(person,spouse) { // get kids
    var mend;  // year marriage ends
    var mspan; // number of years married
    var fertstart;

    (person.dday < spouse.dday) ? mend=person.dday : mend=spouse.dday;

    mspan = mend - person.mday;

    (person.gender=="F") ? fertstart=person.mage : fertstart=spouse.mage;

    var newcolor=parseInt(spouse.gencolor)+1;

    if (newcolor==14){newcolor=1;}

    var yom=0;
    while (yom <= mspan) {
	if ( rollD(100) < getfert(fertstart+yom) ) {
	    var kid = new Object();

	    kid.parent = spouse.pid;
	    pid++;
	    kid.pid="person"+pid;

	    kid.gender=randgen();
	    kid.name=getname(kid);

	    kid.bday=spouse.mday + yom;
	    kid.dage=getdage();

	    kid.dday = kid.dage + kid.bday;
	    kid.mage = Math.abs(getbday(0,kid.gender)); 
	    kid.mday = kid.bday + kid.mage;

	    kid.family = true;

	    if ((kid.mday > kid.dday) || (rollD(100) < 4)) { 
		kid.mage =null;
		kid.mday =null;
		kid.family =null;
	    }

	    kid.ptype=goGetType();

	    kid.gencolor=newcolor;

	    displayperson(kid);

	    yom += rollD(2)+rollD(2)+rollD(2)-2;  // delay before trying for kid.
	}
	yom++;
    }
}
function getParent(parent) { // recreate parent info from text nodes
    parentnode=document.getElementById(parent);
    var newparent=new Object();
    newparent.pid=parent; 
    newparent.name=parentnode.firstChild.firstChild.value;
    oldcolor=parentnode.className.substring(parentnode.className.indexOf("r")+1,parentnode.className.length);
    newparent.gencolor=oldcolor;
    newparent.gender=parentnode.firstChild.nextSibling.firstChild.nodeValue.charAt(6);
    lived=parentnode.firstChild.nextSibling.nextSibling.firstChild.nodeValue;
    newparent.bday=parseInt(lived.substring(8,lived.indexOf("t")));
    newparent.dday=parseInt(lived.substring(lived.indexOf("o")+1,lived.length));
    married=parentnode.firstChild.nextSibling.nextSibling.nextSibling.firstChild.nodeValue;
    newparent.mday=parseInt(married.substring(20,married.lastIndexOf("/")));
    newparent.mage=parseInt(married.substring(married.lastIndexOf("/")+1,married.length));
    died=parentnode.firstChild.nextSibling.nextSibling.nextSibling.nextSibling.firstChild.nodeValue;
    newparent.dage=parseInt(died.substring(12,died.length));
    return newparent;
}
function getSpouse(person) { // getFamily calls this
    var spouse=new Object();

    pid++;
    spouse.parent=person.pid;

    spouse.pid="person"+pid;

    spouse.gender=getOpositeGender(person.gender);

    spouse.name=getname(spouse);

    spouse.mday=person.mday;
    spouse.bday=getbday(spouse.mday,spouse.gender);

    spouse.mage=spouse.mday-spouse.bday;	

    spouse.dage=getdage(spouse.mday,spouse.mage);
    spouse.dday=spouse.bday+spouse.dage;

    spouse.ptype=goGetType();	 
    spouse.gencolor=person.gencolor;
    return spouse;
}

function getFamily(person) { // child calls this
    document.getElementById("family"+person).style.display="none"; // hide button
    newparent = getParent(person);

    if(rollD(100)>3) { // need to make sure marriage isn't automatic
	spouse = getSpouse(newparent); // get spouse
	displayperson(spouse); // display spouse
	getKids(newparent,spouse); // get kids

	grief = spouse.dday;
	while (newparent.dday>=grief) { // check for remarriage until death
	    grief+=rollD(2)+rollD(2)+rollD(2)-2; // delay before remarriage
	    newchance=(newparent.dday-grief)*2; // 2% chance/year before 50
	    newparent.mday=grief; // make sure remarriage date is correct
	    if(rollD(100)<newchance) {
		spouse=getSpouse(newparent); // get spouse
		displayperson(spouse); // display spouse
		getKids(newparent,spouse); // get kids
	    } 
	}
    }
}

function getFormData() {	// start here, pull data from form or generate missing info
    //	document.getElementById("getinfo").style.display=='none';
    var person = new Object();
    person.parent="person"+pid;
    pid++;
    person.pid="person"+pid;
    (document.startform.gender1.value != "x") ? person.gender=document.startform.gender1.value : person.gender=getOpositeGender(person.gender);
    (document.startform.name1.value) ? person.name=document.startform.name1.value : person.name=getname(person);
    (document.startform.married1.value) ? person.mday=parseInt(document.startform.married1.value) : person.mday=0;
    (document.startform.born1.value) ? person.bday=parseInt(document.startform.born1.value) : person.bday=getbday(person.mday,person.gender);
    person.mage=person.mday-person.bday;
    (document.startform.died1.value) ? person.dday=parseInt(document.startform.died1.value) : person.dday=getdage(person.mday,person.mage);
    person.dage=person.dday-person.bday;
    person.ptype=goGetType();
    person.gencolor=1;
    displayperson(person); 
    var spouse = new Object();
    spouse.parent="person"+pid;
    pid++
    spouse.pid="person"+pid; 
    spouse.gender=getOpositeGender(person.gender);
    (document.startform.name2.value) ? spouse.name=document.startform.name2.value : spouse.name=getname(spouse);

    spouse.mday=person.mday;
    (document.startform.born2.value) ? spouse.bday=parseInt(document.startform.born2.value) : spouse.bday=getbday(spouse.mday,spouse.gender);
    spouse.mage=spouse.mday-spouse.bday;
    (document.startform.died2.value) ? spouse.dday=parseInt(document.startform.died2.value) : spouse.dday=getdage(person.mday,spouse.mage);
    spouse.dage=spouse.dday-spouse.bday;	
    spouse.ptype=goGetType();
    spouse.gencolor=1;
    displayperson(spouse);
    getKids(person,spouse);
}

function getNode(words) { // displayperson calls this ??????
    newText=document.createTextNode(words);
    newLI=document.createElement('li');
    newLI.appendChild(newText);
    return newLI;
}

function displayperson(person) { // create and append nodes with person info
    document.getElementById("getinfo").style.display="none";
    document.getElementById("intro").style.display="none";
    document.getElementById("footer").style.display="none";
    var goeshere=document.getElementById(person.parent);
    var newlist=document.createElement("ul");
    newlist.setAttribute("id",person.pid);
    newlist.className="color"+person.gencolor;
    var itembox=document.createElement("input"); 
    itembox.setAttribute("type","text");
    itembox.setAttribute("size","8");
    itembox.value=person.name;
    var itemname=document.createElement("li");
    var rename=document.createElement("a");
    rename.setAttribute("href","javascript:getNewName(\""+person.pid+"\", \"" + getname(person) + "\");");	
    var atext=document.createTextNode(" Rename ");	
    var gentext=document.createTextNode(" sex: "+person.gender);
    var itemgen=document.createElement("li");	
    var livedtext=document.createTextNode(", lived: "+person.bday+" to "+person.dday);
    var itemlived=document.createElement("li");		
    var mdaytext=document.createTextNode(", date/age married: "+person.mday+"/"+person.mage);		
    var itemmday=document.createElement("li");
    var dagetext=document.createTextNode(", age died: "+person.dage);		
    var itemdage=document.createElement("li");
    var ptypetext=document.createTextNode(person.ptype);
    var itemptype=document.createElement("li");
    if (person.family) {
	var getfam=document.createElement("a");
	getfam.setAttribute("href","javascript:getFamily(\""+person.pid+"\");");
	getfam.setAttribute("id","family"+person.pid);
	var getfamtext=document.createTextNode(" Get Family ");
    }
    itemname.appendChild(itembox);
    rename.appendChild(atext);
    itemname.appendChild(rename);
    newlist.appendChild(itemname);
    itemgen.appendChild(gentext);
    newlist.appendChild(itemgen);
    itemlived.appendChild(livedtext);		
    newlist.appendChild(itemlived);				
    itemmday.appendChild(mdaytext);
    newlist.appendChild(itemmday);
    itemdage.appendChild(dagetext);
    newlist.appendChild(itemdage);
    itemptype.appendChild(ptypetext);
    if (person.family) {
	getfam.appendChild(getfamtext);
	itemptype.appendChild(getfam);
    }
    newlist.appendChild(itemptype);	
    goeshere.appendChild(newlist);
}
</script>
      </head>
      <body>
        <h1 align="center">Random Family Tree Generator 1.1</h1>
        <div id="intro">Have a long lineage of kings you need to flesh out, or perhaps a character with a big family and you need to figure out how big?	This tool may be able to help.	If you have a patriarch/matriarch in mind, just put in as much information you have and click on "generate".	The program will fill in the rest of their biographic information and determine their offspring using pre-modern actuarial information.	 (At least the best I could find.)	The tool includes a (very) crude name generator and will randomly generate a <a href="http://en.wikipedia.org/wiki/Myers-Briggs_Type_Indicator">Myers-Briggs Type Indicator</a> to help give some feel of what these people might be like. (In the case of royal dynasties this may help describe the nature of their rule.)</div>

        <div id="person0"></div>
        <div id="getinfo">
          <form action="#" method="post" name="startform">
            <p>Name1: <input name="name1" type="text" /> Gender: <select name="gender1" ><option value="x" selected="selected">?</option><option value="M">M</option><option value="F">F</option></select> Year Born: <input name="born1" type="text" size="4" /> Year Married: <input name="married1" type="text" size="4" /> Year Died: <input name="died1" type="text" size="4" /></p>
            <p>Name2: <input name="name2" type="text" /> Year Born: <input name="born2" type="text" size="4" /> Year Married: <input name="married2" type="text" size="4" /> Year Died: <input name="died2" type="text" size="4" /></p>

            <input name="generate" type="button" value="Generate" onclick="getFormData();" />
          </form>
        </div>
        <div id="footer"><a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/3.0/us/"><img alt="Creative Commons License" style="border-width:0" src="http://creativecommons.org/images/public/somerights20.png" align="left" /></a> &nbsp;&nbsp;<span xmlns:dc="http://purl.org/dc/elements/1.1/" href="http://purl.org/dc/dcmitype/InteractiveResource" property="dc:title" rel="dc:type"> Random Family Tree  Generator 1.1</span> by <a xmlns:cc="http://creativecommons.org/ns#" href="http://ja.partridgez.com" property="cc:attributionName" rel="cc:attributionURL">Jeff Partridge</a> and <a xmlns:cc="http://creativecommons.org/ns#" href="http://ja.partridgez.com" property="cc:attributionName" rel="cc:attributionURL">Todd Stumpf</a> is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/3.0/us/">Creative Commons Attribution-Noncommercial-Share Alike 3.0 United States License</a>.</div>
      </body>
    </html>
